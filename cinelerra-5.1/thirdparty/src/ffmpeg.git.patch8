--- a/libavformat/mpegenc.c	2019-08-05 14:52:21.000000000 -0600
+++ /blibavformat/mpegenc.c	2019-11-14 14:07:57.407883232 -0700
@@ -981,9 +981,9 @@
         PacketDesc *pkt_desc;
 
         while ((pkt_desc = stream->predecode_packet) &&
+               pkt_desc != stream->premux_packet &&
                scr > pkt_desc->dts) { // FIXME: > vs >=
-            if (stream->buffer_index < pkt_desc->size ||
-                stream->predecode_packet == stream->premux_packet) {
+            if (stream->buffer_index < pkt_desc->size) {
                 av_log(ctx, AV_LOG_ERROR,
                        "buffer underflow st=%d bufi=%d size=%d\n",
                        i, stream->buffer_index, pkt_desc->size);
